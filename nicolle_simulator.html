<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Nicolle Dias Simulator - Boss Battle V12</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Arial', sans-serif; touch-action: none; background: #000; }
        
        /* UI Geral */
        #ui-container { position: absolute; top: 20px; left: 20px; color: white; pointer-events: none; z-index: 10; width: 100%; }
        #mission-box {
            background: rgba(255, 0, 222, 0.4);
            border: 2px solid #ff00de;
            padding: 15px;
            border-radius: 10px;
            max-width: 300px;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 0 10px #ff00de;
        }
        h1 { margin: 0; font-size: 18px; color: #ff00de; text-transform: uppercase; }
        h2 { margin: 5px 0 0; font-size: 14px; color: #fff; }

        /* BARRA DE VIDA DO CHEF√ÉO (KAMILLY) */
        #boss-hud {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            max-width: 400px;
            display: none; /* Escondido at√© a fase bonus */
            z-index: 15;
            pointer-events: none;
        }
        #boss-name {
            text-align: center;
            color: #ff0000;
            font-weight: bold;
            font-size: 24px;
            text-shadow: 2px 2px 0 #000;
            margin-bottom: 5px;
            text-transform: uppercase;
        }
        #health-bar-bg {
            width: 100%;
            height: 25px;
            background: #330000;
            border: 3px solid #fff;
            border-radius: 15px;
            overflow: hidden;
        }
        #health-bar-fill {
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, #ff0000, #ff6666);
            transition: width 0.2s ease-out;
        }

        /* Dialogo da Porta */
        #door-dialog {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            border: 2px solid #ff00de;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            display: none;
            z-index: 100;
            color: white;
            box-shadow: 0 0 50px #ff00de;
        }
        .dialog-btn {
            background: #ff00de; color: white; border: none;
            padding: 10px 20px; margin: 10px; font-size: 16px;
            cursor: pointer; border-radius: 5px;
            font-weight: bold;
        }

        /* Notifica√ß√£o do PIX */
        #pix-alert {
            position: absolute;
            top: 20%; left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            color: #000;
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: bold;
            display: none;
            z-index: 101;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            animation: slideDown 0.5s ease-out;
        }
        @keyframes slideDown { from {top: -10%;} to {top: 20%;} }

        /* Bot√£o A√ß√£o e Joystick */
        #action-btn {
            position: absolute; bottom: 30%; right: 20px;
            background: rgba(255, 0, 222, 0.8);
            color: white; width: 90px; height: 90px;
            border-radius: 50%; display: none;
            align-items: center; justify-content: center;
            font-weight: bold; font-size: 16px;
            border: 3px solid #fff; cursor: pointer; z-index: 20;
            box-shadow: 0 0 20px #ff00de;
        }
        #action-btn:active { transform: scale(0.95); background: #fff; color: #ff00de; }

        #joystick-zone { position: absolute; bottom: 50px; left: 50px; width: 150px; height: 150px; z-index: 20; }
        
        #camera-hint {
            position: absolute; top: 10px; right: 10px; color: #aaa; font-size: 12px; pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="ui-container">
        <div id="mission-box">
            <h1 id="mission-title">MISS√ÉO 1</h1>
            <h2 id="mission-desc">Fure a fila e fale com a Hostess.</h2>
        </div>
    </div>

    <div id="boss-hud">
        <div id="boss-name">KAMILLY</div>
        <div id="health-bar-bg">
            <div id="health-bar-fill"></div>
        </div>
    </div>
    
    <div id="camera-hint">üëã Arraste na tela para girar a c√¢mera</div>

    <div id="door-dialog">
        <h3 style="margin-top:0">Hostess diz:</h3>
        <p>"Boa noite! QR Code ou Nome na Lista?"</p>
        <button class="dialog-btn" onclick="escolherEntrada('lista')">Nome na Lista</button>
        <button class="dialog-btn" onclick="escolherEntrada('qrcode')">QR Code</button>
    </div>

    <div id="pix-alert">üí∏ Pix Enviado: R$ 50,00</div>

    <div id="action-btn" onclick="executeAction()">A√á√ÉO</div>
    <div id="joystick-zone"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.9.0/nipplejs.min.js"></script>
    <script type="module">
        import * as THREE from 'https://unpkg.com/three@0.126.0/build/three.module.js';

        // ================= CONFIGURA√á√ÉO =================
        const MAIN_CHARS = {
            nicolle: 'nicolle.png', 
            marcao: 'jeffao.png', 
            hostess: 'hostess.png', 
            keyla: 'keyla.png',
            japa: 'japa.png',
            rival: 'npc12m.png',
            drink_icon: 'drink.png',
            // NOVOS ASSETS DA FASE B√îNUS
            kamilly: 'kamilly.png',
            remedio: 'remedio.png'
        };

        const NPC_GALLERY = [
            'npc1h.png', 'npc2h.png', 'npc3.png', 'npc4m.png', 'npc5h.png',
            'npc6m.png', 'npc7h.png', 'npc8h.png', 'npc9h.png', 'npc10h.png',
            'npc11m.png', 'npc13.png', 'npc14m.png', 'npc15h.png',
            'npc16h.png', 'npc17h.png', 'npc18h.png', 'npc20h.png', 'npc21h.png', 'npc22h.png', 'npc23h.png', 'npc24h.png', 'npc25h.png'
        ];

        const PHRASES = [
            "After no cassiano?", "Algu√©m tem tabaco?", "Vem sempre aqui amor?", 
            "T√° tarde j√°, to indo embora", "Saudade da minha ex", "Algu√©m viu o marc√£o?",
            "Me paga um drink ai vai", "Nossa que calor", "Bola mais um ai"
        ];

        let scene, camera, renderer;
        let nicolle, hostess, marcao;
        let npcs = []; // Lista gen√©rica de NPCs
        let keyla, japa, rival;
        let kamilly; // O Chef√£o
        
        // Estado do Jogo
        let mission = 1;
        let fights = 0;
        let entryGranted = false;
        let nearbyTarget = null;
        let kamillyHealth = 100;
        
        let joystickManager;
        let moveForward = 0, moveSide = 0;
        let discoLights = [];
        let mainDiscoLight; 
        const textureLoader = new THREE.TextureLoader();

        // C√¢mera
        let cameraAngle = 0;
        let cameraDistance = 25;
        let cameraHeight = 15;
        let isDragging = false;
        let previousMouseX = 0;

        // Elementos UI
        const uiTitle = document.getElementById('mission-title');
        const uiDesc = document.getElementById('mission-desc');
        const btnAction = document.getElementById('action-btn');
        const dialogBox = document.getElementById('door-dialog');
        const pixAlert = document.getElementById('pix-alert');
        const bossHud = document.getElementById('boss-hud');
        const healthFill = document.getElementById('health-bar-fill');
        const missionBox = document.getElementById('mission-box'); // Para esconder na boss fight se quiser

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x020202);
            scene.fog = new THREE.Fog(0x020202, 10, 120);

            camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true; 
            document.body.appendChild(renderer.domElement);

            // Luzes
            const ambient = new THREE.AmbientLight(0x606060); scene.add(ambient);
            mainDiscoLight = new THREE.PointLight(0xff00de, 1.0, 70);
            mainDiscoLight.position.set(20, 20, 0); scene.add(mainDiscoLight);
            const outsideLight = new THREE.DirectionalLight(0xffedcc, 1.5); 
            outsideLight.position.set(-30, 50, -20); outsideLight.target.position.set(-10, 0, -10); 
            outsideLight.castShadow = true; scene.add(outsideLight); scene.add(outsideLight.target);
            createDiscoLights();

            // Cen√°rio
            createEnvironment();
            createSignage(); createDJBooth(); createBarArea(); createRestroomArea(); 

            // Personagens Iniciais
            nicolle = createSprite(MAIN_CHARS.nicolle, -40, 2, 0, 5); scene.add(nicolle);
            marcao = createSprite(MAIN_CHARS.marcao, -12, 2.5, -6, 6); scene.add(marcao);
            hostess = createSprite(MAIN_CHARS.hostess, -8, 2, 6, 5); scene.add(hostess);

            // Popula√ß√£o
            spawnCrowd();

            // Fixos
            keyla = createSprite(MAIN_CHARS.keyla, 55, 2, -35, 5);
            keyla.userData = { type: 'keyla' }; keyla.material.color.setHex(0xffaaaa);
            npcs.push(keyla); scene.add(keyla);

            japa = createSprite(MAIN_CHARS.japa, 60, 2, 0, 5);
            japa.userData = { type: 'japa' }; npcs.push(japa); scene.add(japa);

            rival = createSprite(MAIN_CHARS.rival, 62, 2, 0, 4.5);
            rival.material.color.setHex(0xaaffaa); scene.add(rival);

            initJoystick();
            initCameraControls();
            startRandomSpeechLoop(); 
            animate();
        }

        function spawnCrowd() {
            // Fila
            for(let i=0; i<8; i++) {
                let img = NPC_GALLERY[Math.floor(Math.random() * NPC_GALLERY.length)];
                let npc = createSprite(img, -14, 2, -8 - (i * 2.5), 4);
                npc.userData.isTalking = false; npcs.push(npc); scene.add(npc);
            }
            // Pista
            for(let i=0; i<25; i++) { 
                let img = NPC_GALLERY[Math.floor(Math.random() * NPC_GALLERY.length)];
                let isMan = img.toLowerCase().includes('h');
                let npc = createSprite(img, 10 + Math.random()*50, 2, -30 + Math.random()*60, 4.5);
                npc.userData.isTalking = false;
                if (!isMan) npc.userData.type = 'woman_fight';
                else {
                    let hasDrink = Math.random() > 0.4;
                    npc.userData.type = hasDrink ? 'man_drink' : 'man';
                    if(hasDrink) { let cup = createSprite(MAIN_CHARS.drink_icon, 0.5, -0.1, 0.1, 0.4); npc.add(cup); }
                }
                npcs.push(npc); scene.add(npc);
            }
        }

        // --- FASE B√îNUS: BOSS BATTLE ---
        function startBonusPhase() {
            mission = 6;
            
            // 1. Limpar Cena (Thanos Snap)
            // Remove todos os NPCs da lista npcs
            npcs.forEach(npc => scene.remove(npc));
            npcs = []; // Zera a lista
            
            // Remove personagens espec√≠ficos
            scene.remove(marcao);
            scene.remove(hostess);
            scene.remove(keyla);
            scene.remove(japa);
            scene.remove(rival);

            // 2. Setup Nicolle
            nicolle.position.set(40, 2, 0); // Posiciona Nicolle no meio da pista
            cameraAngle = -Math.PI / 2; // C√¢mera olhando para o palco

            // 3. Spawn Kamilly (Chef√£o)
            kamilly = createSprite(MAIN_CHARS.kamilly, 60, 2.5, 0, 6); // Ela √© maior (Escala 6)
            kamilly.userData = { type: 'boss' };
            
            // Adicionar o Rem√©dio na m√£o dela
            let remedio = createSprite(MAIN_CHARS.remedio, 1.2, 0, 0.1, 1.5);
            kamilly.add(remedio);
            
            npcs.push(kamilly); // Adiciona na lista para detec√ß√£o de colis√£o
            scene.add(kamilly);

            // 4. UI Updates
            bossHud.style.display = 'block'; // Mostra barra de vida
            updateUI("DERROTAR A KAMILLY", "Salvar o Jeff");
            
            alert("‚ö†Ô∏è ALERTA DE CHEF√ÉO: KAMILLY APARECEU!");
        }

        function hitBoss() {
            kamillyHealth -= 10;
            healthFill.style.width = kamillyHealth + "%";

            // Efeito visual de dano
            kamilly.material.color.setHex(0xff0000); // Pisca vermelho
            setTimeout(() => kamilly.material.color.setHex(0xffffff), 200);
            
            // Pulo de impacto
            kamilly.position.y += 1;
            setTimeout(() => kamilly.position.y -= 1, 150);

            if (kamillyHealth <= 0) {
                // Vit√≥ria Final
                kamilly.rotation.z = Math.PI / 2; // Cai no ch√£o
                kamilly.position.y = 0.5;
                bossHud.style.display = 'none';
                btnAction.style.display = 'none';
                
                updateUI("VOC√ä SALVOU O JEFF!", "Parab√©ns! Nicolle derrotou a Kamilly e dominou a Lucky Scope.");
                setTimeout(() => alert("üéâ FIM DE JOGO! VOC√ä ZEROU TUDO! üéâ"), 500);
            }
        }


        // ... [CONTROLES, JOYSTICK, CEN√ÅRIO - MANTIDOS IGUAIS] ...
        // (Vou omitir as fun√ß√µes repetidas de createEnvironment, etc para n√£o estourar o limite, 
        // mas elas devem estar aqui exatamente como na V11)
        
        // --- UPDATE DO L√ìGICA ---
        function updateGameLogic() {
            // Movimento (Igual V11)
            const camDirX = -Math.sin(cameraAngle); const camDirZ = -Math.cos(cameraAngle); 
            const camRightX = -Math.cos(cameraAngle); const camRightZ = Math.sin(cameraAngle);
            const speed = 0.25;
            const finalMoveX = (camDirX * moveForward + camRightX * moveSide) * speed;
            const finalMoveZ = (camDirZ * moveForward + camRightZ * moveSide) * speed;
            nicolle.position.x += finalMoveX; nicolle.position.z += finalMoveZ;

            if (!entryGranted && nicolle.position.x > -8) {
                nicolle.position.x = -8.2; dialogBox.style.display = 'block'; moveForward = 0; moveSide = 0; 
            }

            // Anima√ß√µes de Luz
            const time = Date.now() * 0.001;
            mainDiscoLight.intensity = 0.8 + Math.sin(time * 2) * 0.4;
            discoLights.forEach(dl => {
                dl.target.position.x = 30 + Math.cos(time * dl.speed + dl.offset) * 30;
                dl.target.position.z = Math.sin(time * dl.speed + dl.offset) * 40;
                if(Math.random() > 0.92) dl.light.intensity = 5; else dl.light.intensity = 1;
            });

            // Intera√ß√µes
            btnAction.style.display = 'none';
            nearbyTarget = null;

            // Filtro especial para o Boss
            npcs.forEach(npc => {
                if (nicolle.position.distanceTo(npc.position) < 6) { // Boss tem hitbox maior
                    if (mission === 6 && npc.userData.type === 'boss' && kamillyHealth > 0) {
                        showBtn("BATER üëä", npc);
                    }
                }
                
                // NPCs normais
                if (nicolle.position.distanceTo(npc.position) < 5 && !npc.userData.interacted) {
                    if (mission === 2 && npc.userData.type === 'woman_fight') showBtn("BRIGAR", npc);
                    if (mission === 3 && npc.userData.type === 'man_drink') showBtn("PEGAR DRINK", npc);
                    if (mission === 4 && npc.userData.type === 'keyla') showBtn("MOLHAR KEYLA", npc);
                    if (mission === 5 && npc.userData.type === 'japa') showBtn("PEGAR JAPA", npc);
                }
            });
        }

        window.executeAction = function() {
            if(!nearbyTarget) return;
            nicolle.position.y += 1.5; setTimeout(()=>nicolle.position.y-=1.5, 200); 

            if (mission === 6) {
                // L√≥gica de Bater no Chef√£o
                hitBoss();
                return;
            }

            if(mission === 2) {
                nearbyTarget.userData.interacted = true;
                nearbyTarget.material.color.setHex(0x555555); nearbyTarget.rotation.z = 1.5; 
                fights++; updateUI("MISS√ÉO 2", `Brigas: ${fights}/3`);
                if(fights>=3) { mission=3; updateUI("MISS√ÉO 3: DRINK", "V√° ao BAR ou ache algu√©m com bebida!"); }
            }
            else if(mission === 3) {
                nearbyTarget.userData.interacted = true;
                nearbyTarget.children[0].visible = false;
                mission=4; updateUI("MISS√ÉO 4: KEYLA", "Keyla est√° perto do BAR. Derrube nela!");
            }
            else if(mission === 4) {
                nearbyTarget.userData.interacted = true;
                nearbyTarget.material.color.setHex(0xff0000);
                mission=5; updateUI("MISS√ÉO FINAL", "O Japa est√° na frente do Palco DJ GATTI!");
            }
            else if(mission === 5) {
                // Fim da Miss√£o 5 -> IN√çCIO DA FASE B√îNUS
                rival.position.x += 10;
                // nicolle.position.x = japa.position.x - 2; 
                alert("JAPA CONQUISTADO! MAS ESPERE...");
                setTimeout(startBonusPhase, 1000); // Come√ßa a fase b√¥nus em 1 seg
            }
        }

        // Fun√ß√µes de UI, Fala e Ambiente (Copiar da V11)
        function updateUI(t, d) { uiTitle.innerText=t; uiDesc.innerText=d; }
        window.escolherEntrada = function(tipo) { dialogBox.style.display='none'; if(tipo==='qrcode'){pixAlert.style.display='block';setTimeout(()=>{pixAlert.style.display='none'},3000);} entryGranted=true; mission=2; updateUI("MISS√ÉO 2: AS BRIGAS", "Puxe o cabelo de 3 mulheres!"); nicolle.position.x=-4; };
        function showBtn(txt, tgt) { nearbyTarget = tgt; btnAction.innerText = txt; btnAction.style.display = 'flex'; }
        
        function startRandomSpeechLoop() { setInterval(() => { if (npcs.length === 0 || mission === 6) return; let speaker = npcs[Math.floor(Math.random() * npcs.length)]; if (speaker && !speaker.userData.isTalking) { let phrase = PHRASES[Math.floor(Math.random() * PHRASES.length)]; speak(speaker, phrase); } }, 8000); }
        function speak(npc, text) { npc.userData.isTalking=true; const c=document.createElement('canvas');const ctx=c.getContext('2d');c.width=256;c.height=128;ctx.fillStyle='#fff';ctx.fillRect(10,10,236,108);ctx.strokeRect(10,10,236,108);ctx.font='bold 24px Arial';ctx.fillStyle='#000';ctx.textAlign='center';ctx.textBaseline='middle'; ctx.fillText(text,128,64); const tex=new THREE.CanvasTexture(c);const s=new THREE.Sprite(new THREE.SpriteMaterial({map:tex}));s.position.set(0,1.8,0);s.scale.set(1.5,0.75,1);npc.add(s);setTimeout(()=>{npc.remove(s);npc.userData.isTalking=false;},4000); }
        
        function initCameraControls() { document.addEventListener('mousedown',onPointerDown);document.addEventListener('mousemove',onPointerMove);document.addEventListener('mouseup',onPointerUp);document.addEventListener('touchstart',onPointerDown,{passive:false});document.addEventListener('touchmove',onPointerMove,{passive:false});document.addEventListener('touchend',onPointerUp); }
        function onPointerDown(e){if(e.target.id==='action-btn'||e.target.closest('#joystick-zone'))return;isDragging=true;previousMouseX=e.clientX||e.touches[0].clientX;}
        function onPointerMove(e){if(!isDragging)return;const c=e.clientX||e.touches[0].clientX;const d=c-previousMouseX;cameraAngle-=d*0.005;previousMouseX=c;}
        function onPointerUp(){isDragging=false;}
        function initJoystick(){joystickManager=nipplejs.create({zone:document.getElementById('joystick-zone'),mode:'static',position:{left:'50%',top:'50%'},color:'white'});joystickManager.on('move',(e,d)=>{moveSide=-Math.cos(d.angle.radian);moveForward=Math.sin(d.angle.radian);});joystickManager.on('end',()=>{moveForward=0;moveSide=0;});}
        
        function createEnvironment(){const a=new THREE.Mesh(new THREE.PlaneGeometry(200,200),new THREE.MeshStandardMaterial({color:0x111111,roughness:0.9}));a.rotation.x=-Math.PI/2;a.position.y=-0.05;scene.add(a);const s=new THREE.Mesh(new THREE.PlaneGeometry(30,60),new THREE.MeshStandardMaterial({color:0x555555,roughness:0.6}));s.rotation.x=-Math.PI/2;s.position.set(-20,0,0);scene.add(s);const c=new THREE.Mesh(new THREE.PlaneGeometry(100,100),new THREE.MeshStandardMaterial({color:0x220022,roughness:0.1}));c.rotation.x=-Math.PI/2;c.position.set(40,0.01,0);scene.add(c);const w=new THREE.MeshStandardMaterial({color:0x000000});const w1=new THREE.Mesh(new THREE.BoxGeometry(2,12,100),w);w1.position.set(-10,6,0);scene.add(w1);const w2=new THREE.Mesh(new THREE.BoxGeometry(2,12,100),w);w2.position.set(75,6,0);scene.add(w2);const w3=new THREE.Mesh(new THREE.BoxGeometry(87,12,2),w);w3.position.set(32.5,6,50);scene.add(w3);const w4=new THREE.Mesh(new THREE.BoxGeometry(87,12,2),w);w4.position.set(32.5,6,-50);scene.add(w4);createColumn(-10,6,8);createColumn(-10,6,-8);}
        function createColumn(x,y,z){const m=new THREE.Mesh(new THREE.BoxGeometry(3,12,3),new THREE.MeshStandardMaterial({color:0x333333}));m.position.set(x,y,z);scene.add(m);}
        function createSignage(){const c=document.createElement('canvas');c.width=512;c.height=256;const x=c.getContext('2d');x.fillStyle='#110011';x.fillRect(0,0,512,256);x.strokeStyle='#ff00de';x.lineWidth=15;x.strokeRect(10,10,492,236);x.font='bold 60px Arial';x.fillStyle='#ff00de';x.textAlign='center';x.fillText("LUCKY SCOPE",256,120);x.font='italic 30px Arial';x.fillStyle='#fff';x.fillText("Nosso After",256,180);const t=new THREE.CanvasTexture(c);const m=new THREE.Mesh(new THREE.PlaneGeometry(14,7),new THREE.MeshBasicMaterial({map:t,transparent:true,side:THREE.DoubleSide}));m.position.set(-11.5,10,0);m.rotation.y=-Math.PI/2;scene.add(m);}
        function createDJBooth(){const s=new THREE.Mesh(new THREE.BoxGeometry(10,4,30),new THREE.MeshStandardMaterial({color:0x111111}));s.position.set(70,2,0);scene.add(s);const t=new THREE.Mesh(new THREE.BoxGeometry(4,3,10),new THREE.MeshStandardMaterial({color:0x333333}));t.position.set(66,4,0);scene.add(t);const c=document.createElement('canvas');c.width=256;c.height=128;const x=c.getContext('2d');x.fillStyle='#000';x.fillRect(0,0,256,128);x.strokeStyle='#0ff';x.lineWidth=8;x.strokeRect(5,5,246,118);x.font='bold 40px Arial';x.fillStyle='#0ff';x.textAlign='center';x.fillText("DJ GATTI",128,75);const tex=new THREE.CanvasTexture(c);const sg=new THREE.Mesh(new THREE.PlaneGeometry(10,5),new THREE.MeshBasicMaterial({map:tex,side:THREE.DoubleSide}));sg.position.set(65,10,0);sg.rotation.y=-Math.PI/2;scene.add(sg);}
        function createBarArea(){const b=new THREE.Mesh(new THREE.BoxGeometry(30,3,4),new THREE.MeshStandardMaterial({color:0x330000}));b.position.set(30,1.5,-45);scene.add(b);const c=document.createElement('canvas');c.width=128;c.height=64;const x=c.getContext('2d');x.fillStyle='#200';x.fillRect(0,0,128,64);x.font='bold 40px Arial';x.fillStyle='#fa0';x.textAlign='center';x.fillText("BAR",64,45);const t=new THREE.CanvasTexture(c);const s=new THREE.Mesh(new THREE.PlaneGeometry(8,4),new THREE.MeshBasicMaterial({map:t}));s.position.set(30,6,-45);scene.add(s);}
        function createRestroomArea(){const w=new THREE.Mesh(new THREE.BoxGeometry(20,12,1),new THREE.MeshStandardMaterial({color:0x222}));w.position.set(30,6,35);scene.add(w);const c=document.createElement('canvas');c.width=64;c.height=64;const x=c.getContext('2d');x.fillStyle='#fff';x.fillRect(0,0,64,64);x.font='bold 40px Arial';x.fillStyle='#000';x.textAlign='center';x.fillText("WC",32,45);const t=new THREE.CanvasTexture(c);const s=new THREE.Mesh(new THREE.PlaneGeometry(3,3),new THREE.MeshBasicMaterial({map:t}));s.position.set(30,8,34.4);s.rotation.y=Math.PI;scene.add(s);}
        function createDiscoLights(){const c=[0xff0000,0x00ff00,0x0000ff,0xffff00];for(let i=0;i<4;i++){const l=new THREE.SpotLight(c[i],3);l.position.set(30,25,0);l.angle=Math.PI/6;l.penumbra=0.5;l.distance=80;const t=new THREE.Object3D();scene.add(t);l.target=t;scene.add(l);discoLights.push({light:l,target:t,offset:i*2,speed:0.02+(i*0.01)});}}
        function createSprite(u,x,y,z,s){const m=textureLoader.load(u);const mat=new THREE.SpriteMaterial({map:m});const sp=new THREE.Sprite(mat);sp.position.set(x,y,z);sp.scale.set(s,s,1);return sp;}
        function animate(){requestAnimationFrame(animate);updateGameLogic();const ox=Math.sin(cameraAngle)*cameraDistance;const oz=Math.cos(cameraAngle)*cameraDistance;camera.position.x=nicolle.position.x+ox;camera.position.z=nicolle.position.z+oz;camera.position.y=nicolle.position.y+cameraHeight;camera.lookAt(nicolle.position);renderer.render(scene,camera);}

        init();
        window.addEventListener('resize', () => {camera.aspect=window.innerWidth/window.innerHeight;camera.updateProjectionMatrix();renderer.setSize(window.innerWidth,window.innerHeight);});
    </script>
</body>
</html>
