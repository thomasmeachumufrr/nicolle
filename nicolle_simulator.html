<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Nicolle Dias Simulator - Lucky Scope Deluxe</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Arial', sans-serif; touch-action: none; background: #000; }
        
        /* UI Geral */
        #ui-container { position: absolute; top: 20px; left: 20px; color: white; pointer-events: none; z-index: 10; }
        #mission-box {
            background: rgba(255, 0, 222, 0.4);
            border: 2px solid #ff00de;
            padding: 15px;
            border-radius: 10px;
            max-width: 300px;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 0 10px #ff00de;
        }
        h1 { margin: 0; font-size: 18px; color: #ff00de; text-transform: uppercase; }
        h2 { margin: 5px 0 0; font-size: 14px; color: #fff; }

        /* Dialogo da Porta */
        #door-dialog {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            border: 2px solid #ff00de;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            display: none;
            z-index: 100;
            color: white;
            box-shadow: 0 0 50px #ff00de;
        }
        .dialog-btn {
            background: #ff00de; color: white; border: none;
            padding: 10px 20px; margin: 10px; font-size: 16px;
            cursor: pointer; border-radius: 5px;
            font-weight: bold;
        }
        .dialog-btn:hover { background: #fff; color: #ff00de; }

        /* Notificaﾃｧﾃ｣o do PIX */
        #pix-alert {
            position: absolute;
            top: 20%; left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            color: #000;
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: bold;
            display: none;
            z-index: 101;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            animation: slideDown 0.5s ease-out;
        }
        @keyframes slideDown { from {top: -10%;} to {top: 20%;} }

        /* Botﾃ｣o Aﾃｧﾃ｣o e Joystick */
        #action-btn {
            position: absolute; bottom: 30%; right: 20px;
            background: rgba(255, 0, 222, 0.8);
            color: white; width: 90px; height: 90px;
            border-radius: 50%; display: none;
            align-items: center; justify-content: center;
            font-weight: bold; font-size: 16px;
            border: 3px solid #fff; cursor: pointer; z-index: 20;
            box-shadow: 0 0 20px #ff00de;
        }
        #joystick-zone { position: absolute; bottom: 50px; left: 50px; width: 150px; height: 150px; z-index: 20; }
    </style>
</head>
<body>

    <div id="ui-container">
        <div id="mission-box">
            <h1 id="mission-title">MISSﾃグ 1</h1>
            <h2 id="mission-desc">Vﾃ｡ atﾃｩ a porta e fale com a Hostess.</h2>
        </div>
    </div>

    <div id="door-dialog">
        <h3 style="margin-top:0">Hostess diz:</h3>
        <p>"Boa noite! QR Code ou Nome na Lista?"</p>
        <button class="dialog-btn" onclick="escolherEntrada('lista')">Nome na Lista</button>
        <button class="dialog-btn" onclick="escolherEntrada('qrcode')">QR Code</button>
    </div>

    <div id="pix-alert">頂 Pix Enviado: R$ 50,00</div>

    <div id="action-btn" onclick="executeAction()">Aﾃﾃグ</div>
    <div id="joystick-zone"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.9.0/nipplejs.min.js"></script>
    <script type="module">
        import * as THREE from 'https://unpkg.com/three@0.126.0/build/three.module.js';

        // ================= CONFIGURAﾃﾃグ DE IMAGENS =================
        const MAIN_CHARS = {
            nicolle: 'nicolle.png', 
            marcao: 'jeffao.png', 
            hostess: 'hostess.png', 
            keyla: 'https://cdn-icons-png.flaticon.com/512/4140/4140073.png',
            japa: 'japa.png',
            rival: 'https://cdn-icons-png.flaticon.com/512/4140/4140051.png',
            drink_icon: 'drink.png'
        };

        const NPC_GALLERY = [
            'npc1.png', 'npc2.png', 'npc3.png', 'npc4.png', 'npc5.png',
            'npc6.png', 'npc7.png', 'npc8.png', 'npc9.png', 'npc10.png',
            'npc11.png', 'npc12.png', 'npc13.png', 'npc14.png', 'npc15.png',
            'npc16.png', 'npc17.png', 'npc18.png', 'npc19.png', 'npc20.png', 'npc21.png',
        ];
        // ===========================================================

        let scene, camera, renderer;
        let nicolle, hostess, marcao;
        let npcs = [];
        let keyla, japa, rival;
        let mission = 1;
        let fights = 0;
        let entryGranted = false;
        let nearbyTarget = null;
        let joystickManager;
        let moveForward = 0, moveSide = 0;
        let discoLights = []; // Array para as luzes mﾃｳveis
        const textureLoader = new THREE.TextureLoader();

        // Elementos UI
        const uiTitle = document.getElementById('mission-title');
        const uiDesc = document.getElementById('mission-desc');
        const btnAction = document.getElementById('action-btn');
        const dialogBox = document.getElementById('door-dialog');
        const pixAlert = document.getElementById('pix-alert');

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x050505);
            scene.fog = new THREE.Fog(0x050505, 10, 90);

            camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.set(0, 15, 25); // Camera um pouco mais alta para ver tudo

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true; // Habilitar sombras
            document.body.appendChild(renderer.domElement);

            // --- LUZES ---
            const ambient = new THREE.AmbientLight(0x404040); // Luz base fraca
            scene.add(ambient);
            
            // Luz Principal da Pista
            const mainLight = new THREE.PointLight(0xff00de, 0.8, 60);
            mainLight.position.set(20, 20, 0);
            scene.add(mainLight);

            // Canhﾃｵes de Luz (Jogos de Luz)
            createDiscoLights();

            // --- CENﾃヽIO ---
            createEnvironment();
            createSignage(); // Placa Frente
            createDJBooth(); // Palco DJ GATTI
            createBarArea(); // ﾃ〉ea do Bar
            createRestroomArea(); // Banheiro

            // --- PERSONAGENS ---
            
            // Nicolle
            nicolle = createSprite(MAIN_CHARS.nicolle, -40, 2, 0, 5);
            scene.add(nicolle);

            // Marcﾃ｣o e Hostess
            marcao = createSprite(MAIN_CHARS.marcao, -12, 2.5, -6, 6);
            scene.add(marcao);
            hostess = createSprite(MAIN_CHARS.hostess, -8, 2, 6, 5);
            scene.add(hostess);

            // Fila Organizada
            for(let i=0; i<10; i++) {
                let randomImg = NPC_GALLERY[Math.floor(Math.random() * NPC_GALLERY.length)];
                let npc = createSprite(randomImg, -16, 2, -15 - (i * 3), 4); // Fila reta
                npc.material.color.setHex(0xaaaaaa); 
                scene.add(npc);
            }

            // Balada (Pista)
            for(let i=0; i<25; i++) { // Mais gente
                let randomImg = NPC_GALLERY[Math.floor(Math.random() * NPC_GALLERY.length)];
                let isMan = Math.random() > 0.5;
                // Espalhar na ﾃ｡rea central (evitar paredes)
                let npc = createSprite(randomImg, 10 + Math.random()*50, 2, -30 + Math.random()*60, 4.5);
                
                if (!isMan) {
                    npc.userData = { type: 'woman_fight', interacted: false };
                } else {
                    let hasDrink = Math.random() > 0.4;
                    npc.userData = { type: hasDrink ? 'man_drink' : 'man', interacted: false };
                    if(hasDrink) {
                        let cup = createSprite(MAIN_CHARS.drink_icon, 0.6, -0.5, 0.1, 0.4); 
                        npc.add(cup);
                    }
                }
                npcs.push(npc);
                scene.add(npc);
            }

            // Personagens da Missﾃ｣o Final (Perto do DJ agora)
            keyla = createSprite(MAIN_CHARS.keyla, 55, 2, -35, 5); // Canto perto do bar
            keyla.userData = { type: 'keyla' };
            keyla.material.color.setHex(0xffaaaa);
            npcs.push(keyla);
            scene.add(keyla);

            japa = createSprite(MAIN_CHARS.japa, 60, 2, 0, 5); // Frente do DJ
            japa.userData = { type: 'japa' };
            npcs.push(japa);
            scene.add(japa);

            rival = createSprite(MAIN_CHARS.rival, 62, 2, 0, 4.5);
            rival.material.color.setHex(0xaaffaa);
            scene.add(rival);

            initJoystick();
            animate();
        }

        // --- CONSTRUﾃﾃグ DO CENﾃヽIO ---

        function createDiscoLights() {
            // Cria 4 Spotlights coloridos que vﾃ｣o girar
            const colors = [0xff0000, 0x00ff00, 0x0000ff, 0xffff00];
            for(let i=0; i<4; i++) {
                const light = new THREE.SpotLight(colors[i], 2);
                light.position.set(30, 25, 0); // Todos saem do teto central
                light.angle = Math.PI / 6;
                light.penumbra = 0.5;
                light.distance = 80;
                
                // Objeto alvo invisﾃｭvel para mover a luz
                const target = new THREE.Object3D();
                scene.add(target);
                light.target = target;
                
                scene.add(light);
                discoLights.push({ light: light, target: target, offset: i * 2, speed: 0.02 + (i*0.01) });
            }
        }

        function createDJBooth() {
            // Palco
            const stage = new THREE.Mesh(new THREE.BoxGeometry(10, 4, 30), new THREE.MeshStandardMaterial({color: 0x111111}));
            stage.position.set(70, 2, 0);
            scene.add(stage);

            // Mesa DJ
            const table = new THREE.Mesh(new THREE.BoxGeometry(4, 3, 10), new THREE.MeshStandardMaterial({color: 0x333333}));
            table.position.set(66, 4, 0);
            scene.add(table);

            // Placa DJ GATTI
            const canvas = document.createElement('canvas');
            canvas.width = 256; canvas.height = 128;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#000'; ctx.fillRect(0,0,256,128);
            ctx.strokeStyle = '#00ffff'; ctx.lineWidth = 8; ctx.strokeRect(5,5,246,118);
            ctx.font = 'bold 40px Arial'; ctx.fillStyle = '#00ffff'; ctx.textAlign = 'center';
            ctx.fillText("DJ GATTI", 128, 75);
            
            const tex = new THREE.CanvasTexture(canvas);
            const sign = new THREE.Mesh(new THREE.PlaneGeometry(10, 5), new THREE.MeshBasicMaterial({map: tex, side: THREE.DoubleSide}));
            sign.position.set(65, 10, 0);
            sign.rotation.y = -Math.PI / 2;
            scene.add(sign);
        }

        function createBarArea() {
            // Parede Fundo (lado negativo do Z)
            const bar = new THREE.Mesh(new THREE.BoxGeometry(30, 3, 4), new THREE.MeshStandardMaterial({color: 0x330000}));
            bar.position.set(30, 1.5, -45);
            scene.add(bar);

            // Placa BAR
            const canvas = document.createElement('canvas');
            canvas.width = 128; canvas.height = 64;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#220000'; ctx.fillRect(0,0,128,64);
            ctx.font = 'bold 40px Arial'; ctx.fillStyle = '#ffaa00'; ctx.textAlign = 'center';
            ctx.fillText("BAR", 64, 45);
            
            const tex = new THREE.CanvasTexture(canvas);
            const sign = new THREE.Mesh(new THREE.PlaneGeometry(8, 4), new THREE.MeshBasicMaterial({map: tex}));
            sign.position.set(30, 6, -45);
            scene.add(sign);
        }

        function createRestroomArea() {
            // Paredes do Banheiro (lado positivo do Z)
            const wall1 = new THREE.Mesh(new THREE.BoxGeometry(20, 12, 1), new THREE.MeshStandardMaterial({color: 0x222222}));
            wall1.position.set(30, 6, 35); // Parede divisﾃｳria
            scene.add(wall1);

            // Placa WC
            const canvas = document.createElement('canvas');
            canvas.width = 64; canvas.height = 64;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#fff'; ctx.fillRect(0,0,64,64);
            ctx.font = 'bold 40px Arial'; ctx.fillStyle = '#000'; ctx.textAlign = 'center';
            ctx.fillText("WC", 32, 45);
            
            const tex = new THREE.CanvasTexture(canvas);
            const sign = new THREE.Mesh(new THREE.PlaneGeometry(3, 3), new THREE.MeshBasicMaterial({map: tex}));
            sign.position.set(30, 8, 34.4);
            sign.rotation.y = Math.PI; // Virada pra pista
            scene.add(sign);
        }

        function createSignage() {
            // Placa Lucky Scope (Jﾃ｡ existente)
            const canvas = document.createElement('canvas');
            canvas.width = 512; canvas.height = 256;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#110011'; ctx.fillRect(0,0,512,256);
            ctx.strokeStyle = '#ff00de'; ctx.lineWidth = 15; ctx.strokeRect(10,10,492,236);
            ctx.font = 'bold 60px Arial'; ctx.fillStyle = '#ff00de'; ctx.textAlign = 'center';
            ctx.fillText("LUCKY SCOPE", 256, 120);
            ctx.font = 'italic 30px Arial'; ctx.fillStyle = '#ffffff'; ctx.fillText("Nosso After", 256, 180);
            
            const texture = new THREE.CanvasTexture(canvas);
            const sign = new THREE.Mesh(new THREE.PlaneGeometry(14, 7), new THREE.MeshBasicMaterial({ map: texture, transparent: true, side: THREE.DoubleSide }));
            sign.position.set(-11.5, 10, 0); 
            sign.rotation.y = -Math.PI / 2;
            scene.add(sign);
        }

        function createEnvironment() {
            // Chﾃ｣o Roxo Claro
            const floor = new THREE.Mesh(new THREE.PlaneGeometry(160, 100), new THREE.MeshStandardMaterial({ color: 0x662266, roughness: 0.1 }));
            floor.rotation.x = -Math.PI/2;
            floor.position.x = 20; // Centralizar melhor
            scene.add(floor);

            // Paredes Externas
            const wallMat = new THREE.MeshStandardMaterial({ color: 0x000000 });
            // Parede Entrada
            const wallEntry = new THREE.Mesh(new THREE.BoxGeometry(2, 12, 100), wallMat);
            wallEntry.position.set(-10, 6, 0);
            scene.add(wallEntry);
            // Parede Fundo (Atrﾃ｡s DJ)
            const wallBack = new THREE.Mesh(new THREE.BoxGeometry(2, 12, 100), wallMat);
            wallBack.position.set(75, 6, 0);
            scene.add(wallBack);
            // Paredes Laterais
            const wallSide1 = new THREE.Mesh(new THREE.BoxGeometry(87, 12, 2), wallMat);
            wallSide1.position.set(32.5, 6, 50);
            scene.add(wallSide1);
            const wallSide2 = new THREE.Mesh(new THREE.BoxGeometry(87, 12, 2), wallMat);
            wallSide2.position.set(32.5, 6, -50);
            scene.add(wallSide2);
            
            // Colunas Entrada
            createColumn(-10, 6, 8);
            createColumn(-10, 6, -8);
        }

        function createColumn(x,y,z) {
            const m = new THREE.Mesh(new THREE.BoxGeometry(3,12,3), new THREE.MeshStandardMaterial({color:0x333333}));
            m.position.set(x,y,z);
            scene.add(m);
        }

        function createSprite(url, x, y, z, s) {
            const map = textureLoader.load(url);
            const mat = new THREE.SpriteMaterial({ map: map });
            const sprite = new THREE.Sprite(mat);
            sprite.position.set(x,y,z);
            sprite.scale.set(s,s,1);
            return sprite;
        }

        function initJoystick() {
            joystickManager = nipplejs.create({
                zone: document.getElementById('joystick-zone'),
                mode: 'static', position: { left: '50%', top: '50%' }, color: 'white'
            });
            joystickManager.on('move', (evt, data) => {
                moveSide = Math.cos(data.angle.radian);
                moveForward = -Math.sin(data.angle.radian);
            });
            joystickManager.on('end', () => { moveForward = 0; moveSide = 0; });
        }

        // --- Lﾃ敵ICA DO JOGO ---
        window.escolherEntrada = function(tipo) {
            dialogBox.style.display = 'none';
            if (tipo === 'qrcode') {
                pixAlert.style.display = 'block';
                setTimeout(() => { pixAlert.style.display = 'none'; }, 3000);
            }
            entryGranted = true;
            mission = 2;
            updateUI("MISSﾃグ 2: AS BRIGAS", "Puxe o cabelo de 3 mulheres na pista! (0/3)");
            nicolle.position.x = -4; 
        };

        function updateGameLogic() {
            nicolle.position.x += moveSide * 0.25; // Um pouco mais rﾃ｡pido
            nicolle.position.z += moveForward * 0.25;

            // Bloqueio Porta
            if (!entryGranted && nicolle.position.x > -8) {
                nicolle.position.x = -8.2; dialogBox.style.display = 'block'; moveForward = 0; moveSide = 0; 
            }

            // Animar Luzes
            const time = Date.now() * 0.001;
            discoLights.forEach(dl => {
                dl.target.position.x = 30 + Math.cos(time * dl.speed + dl.offset) * 30;
                dl.target.position.z = Math.sin(time * dl.speed + dl.offset) * 40;
            });

            btnAction.style.display = 'none';
            nearbyTarget = null;

            npcs.forEach(npc => {
                if (nicolle.position.distanceTo(npc.position) < 5 && !npc.userData.interacted) {
                    if (mission === 2 && npc.userData.type === 'woman_fight') showBtn("BRIGAR", npc);
                    if (mission === 3 && npc.userData.type === 'man_drink') showBtn("PEGAR DRINK", npc);
                    if (mission === 4 && npc.userData.type === 'keyla') showBtn("MOLHAR KEYLA", npc);
                    if (mission === 5 && npc.userData.type === 'japa') showBtn("PEGAR JAPA", npc);
                }
            });
        }

        function showBtn(txt, tgt) {
            nearbyTarget = tgt;
            btnAction.innerText = txt;
            btnAction.style.display = 'flex';
        }

        window.executeAction = function() {
            if(!nearbyTarget) return;
            nicolle.position.y += 1.5; setTimeout(()=>nicolle.position.y-=1.5, 200); 

            if(mission === 2) {
                nearbyTarget.userData.interacted = true;
                nearbyTarget.material.color.setHex(0x555555);
                nearbyTarget.rotation.z = 1.5; 
                fights++;
                updateUI("MISSﾃグ 2", `Brigas: ${fights}/3`);
                if(fights>=3) { mission=3; updateUI("MISSﾃグ 3: DRINK", "Vﾃ｡ ao BAR ou ache alguﾃｩm com bebida!"); }
            }
            else if(mission === 3) {
                nearbyTarget.userData.interacted = true;
                nearbyTarget.children[0].visible = false;
                mission=4; updateUI("MISSﾃグ 4: KEYLA", "Keyla estﾃ｡ perto do BAR. Derrube nela!");
            }
            else if(mission === 4) {
                nearbyTarget.userData.interacted = true;
                nearbyTarget.material.color.setHex(0xff0000);
                mission=5; updateUI("MISSﾃグ FINAL", "O Japa estﾃ｡ na frente do Palco DJ GATTI!");
            }
            else if(mission === 5) {
                rival.position.x += 10;
                nicolle.position.x = japa.position.x - 2; nicolle.position.z = japa.position.z;
                updateUI("FIM DE JOGO", "Vocﾃｪ conquistou o Japa ao som do DJ GATTI!");
                btnAction.style.display = 'none';
            }
        }

        function updateUI(t, d) { uiTitle.innerText=t; uiDesc.innerText=d; }

        function animate() {
            requestAnimationFrame(animate);
            updateGameLogic();
            
            // Camera Segue Nicolle
            camera.position.x = nicolle.position.x; 
            camera.position.z = nicolle.position.z + 20;
            camera.lookAt(nicolle.position.x, 0, nicolle.position.z);
            
            renderer.render(scene, camera);
        }

        init();
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth/window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth,window.innerHeight);
        });
    </script>
</body>
</html>
