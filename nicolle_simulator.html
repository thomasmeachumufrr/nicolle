<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Nicolle Dias Simulator - Lucky Scope</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Arial', sans-serif; touch-action: none; }
        
        /* UI Geral */
        #ui-container { position: absolute; top: 20px; left: 20px; color: white; pointer-events: none; z-index: 10; }
        #mission-box {
            background: rgba(255, 0, 222, 0.4);
            border: 2px solid #ff00de;
            padding: 15px;
            border-radius: 10px;
            max-width: 300px;
            text-shadow: 1px 1px 0 #000;
        }
        h1 { margin: 0; font-size: 18px; color: #ff00de; text-transform: uppercase; }
        h2 { margin: 5px 0 0; font-size: 14px; color: #fff; }

        /* Dialogo da Porta */
        #door-dialog {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            border: 2px solid #ff00de;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            display: none; /* Escondido inicio */
            z-index: 100;
            color: white;
            box-shadow: 0 0 50px #ff00de;
        }
        .dialog-btn {
            background: #ff00de; color: white; border: none;
            padding: 10px 20px; margin: 10px; font-size: 16px;
            cursor: pointer; border-radius: 5px;
        }
        .dialog-btn:hover { background: #fff; color: #ff00de; }

        /* Notificaﾃｧﾃ｣o do PIX */
        #pix-alert {
            position: absolute;
            top: 20%; left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            color: #000;
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: bold;
            display: none;
            z-index: 101;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            animation: slideDown 0.5s ease-out;
        }
        @keyframes slideDown { from {top: -10%;} to {top: 20%;} }

        /* Botﾃ｣o Aﾃｧﾃ｣o e Joystick */
        #action-btn {
            position: absolute; bottom: 30%; right: 20px;
            background: rgba(255, 0, 222, 0.8);
            color: white; width: 80px; height: 80px;
            border-radius: 50%; display: none;
            align-items: center; justify-content: center;
            font-weight: bold; font-size: 14px;
            border: 3px solid #fff; cursor: pointer; z-index: 20;
        }
        #joystick-zone { position: absolute; bottom: 50px; left: 50px; width: 150px; height: 150px; z-index: 20; }
    </style>
</head>
<body>

    <div id="ui-container">
        <div id="mission-box">
            <h1 id="mission-title">MISSﾃグ 1</h1>
            <h2 id="mission-desc">Fure a fila e fale com a Hostess.</h2>
        </div>
    </div>

    <div id="door-dialog">
        <h3 style="margin-top:0">Hostess diz:</h3>
        <p>"Boa noite! QR Code ou Nome na Lista?"</p>
        <button class="dialog-btn" onclick="escolherEntrada('lista')">Nome na Lista</button>
        <button class="dialog-btn" onclick="escolherEntrada('qrcode')">QR Code</button>
    </div>

    <div id="pix-alert">頂 Pix Enviado: R$ 50,00</div>

    <div id="action-btn" onclick="executeAction()">Aﾃﾃグ</div>
    <div id="joystick-zone"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.9.0/nipplejs.min.js"></script>
    <script type="module">
        import * as THREE from 'https://unpkg.com/three@0.126.0/build/three.module.js';

        // ==========================================================
        // ﾃヽEA DE CONFIGURAﾃﾃグ DE IMAGENS (Sua galeria)
        // ==========================================================
        
        // 1. Personagens Especﾃｭficos
        const MAIN_CHARS = {
            nicolle: 'nicolle.png', 
            marcao: 'jeffao.png', 
            hostess: 'hostess.png', 
            keyla: 'https://cdn-icons-png.flaticon.com/512/4140/4140073.png',
            japa: 'japa.png',
            rival: 'https://cdn-icons-png.flaticon.com/512/4140/4140051.png',
            drink_icon: 'drink.png'
        };

        // 2. Galeria de NPCs
        const NPC_GALLERY = [
            'npc1.png', 'npc2.png', 'npc3.png', 'npc4.png', 'npc5.png',
            'npc6.png', 'npc7.png', 'npc8.png', 'npc9.png', 'npc10.png',
            'npc11.png', 'npc12.png', 'npc13.png', 'npc14.png', 'npc15.png',
            'npc16.png', 'npc17.png', 'npc18.png', 'npc19.png', 'npc20.png', 'npc21.png',
        ];

        // ==========================================================

        let scene, camera, renderer;
        let nicolle, hostess, marcao;
        let npcs = [];
        let keyla, japa, rival;
        let mission = 1;
        let fights = 0;
        let entryGranted = false; // Controle da porta
        let nearbyTarget = null;
        let joystickManager;
        let moveForward = 0, moveSide = 0;
        const textureLoader = new THREE.TextureLoader();

        // Elementos UI
        const uiTitle = document.getElementById('mission-title');
        const uiDesc = document.getElementById('mission-desc');
        const btnAction = document.getElementById('action-btn');
        const dialogBox = document.getElementById('door-dialog');
        const pixAlert = document.getElementById('pix-alert');

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x111111);
            scene.fog = new THREE.Fog(0x111111, 10, 80);

            camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.set(0, 8, 15);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Luzes (Aumentei a luz ambiente para ver o chﾃ｣o melhor)
            scene.add(new THREE.AmbientLight(0xcccccc)); 
            const pl = new THREE.PointLight(0xff00de, 1.5, 40);
            pl.position.set(10, 15, 0);
            scene.add(pl);

            // Cenﾃ｡rio
            createEnvironment();
            createSignage(); // Placa Lucky Scope

            // Nicolle
            nicolle = createSprite(MAIN_CHARS.nicolle, -40, 2, 0, 5);
            scene.add(nicolle);

            // Marcﾃ｣o (Seguranﾃｧa)
            marcao = createSprite(MAIN_CHARS.marcao, -12, 2.5, -6, 6);
            scene.add(marcao);

            // Hostess (Recepﾃｧﾃ｣o)
            hostess = createSprite(MAIN_CHARS.hostess, -8, 2, 6, 5);
            scene.add(hostess);

            // NPCs da Fila (AGORA ORGANIZADA)
            for(let i=0; i<10; i++) {
                let randomImg = NPC_GALLERY[Math.floor(Math.random() * NPC_GALLERY.length)];
                // X fixo em -15 (lado de fora), Z variando para formar fila
                let npc = createSprite(randomImg, -15 - (Math.random()*1), 2, -15 - (i * 2.5), 4);
                npc.material.color.setHex(0xaaaaaa); 
                scene.add(npc);
            }

            // NPCs da Balada
            for(let i=0; i<20; i++) {
                let randomImg = NPC_GALLERY[Math.floor(Math.random() * NPC_GALLERY.length)];
                let isMan = Math.random() > 0.5; 
                
                // Distribui na pista
                let npc = createSprite(randomImg, 15 + Math.random()*35, 2, -35 + Math.random()*70, 4.5);
                
                // Lﾃｳgica de Missﾃｵes
                if (!isMan) {
                    npc.userData = { type: 'woman_fight', interacted: false };
                } else {
                    let hasDrink = Math.random() > 0.4;
                    npc.userData = { type: hasDrink ? 'man_drink' : 'man', interacted: false };
                    if(hasDrink) {
                        // DRINK MENOR (Escala 0.4)
                        let cup = createSprite(MAIN_CHARS.drink_icon, 0.6, -0.5, 0.1, 0.4); 
                        npc.add(cup);
                    }
                }
                npcs.push(npc);
                scene.add(npc);
            }

            // Personagens Fixos
            keyla = createSprite(MAIN_CHARS.keyla, 45, 2, -25, 5);
            keyla.userData = { type: 'keyla' };
            keyla.material.color.setHex(0xffaaaa);
            npcs.push(keyla);
            scene.add(keyla);

            japa = createSprite(MAIN_CHARS.japa, 45, 2, 25, 5);
            japa.userData = { type: 'japa' };
            npcs.push(japa);
            scene.add(japa);

            rival = createSprite(MAIN_CHARS.rival, 47, 2, 25, 4.5);
            rival.material.color.setHex(0xaaffaa);
            scene.add(rival);

            initJoystick();
            animate();
        }

        // --- FUNﾃﾃグ DA PLACA "LUCKY SCOPE" (CORRIGIDA) ---
        function createSignage() {
            const canvas = document.createElement('canvas');
            canvas.width = 512; canvas.height = 256;
            const ctx = canvas.getContext('2d');
            
            // Fundo
            ctx.fillStyle = '#110011';
            ctx.fillRect(0,0,512,256);
            
            // Borda Neon
            ctx.strokeStyle = '#ff00de';
            ctx.lineWidth = 15;
            ctx.strokeRect(10,10,492,236);

            // Texto Principal
            ctx.font = 'bold 60px Arial';
            ctx.fillStyle = '#ff00de'; 
            ctx.textAlign = 'center';
            ctx.fillText("LUCKY SCOPE", 256, 120);

            // Texto Secundﾃ｡rio
            ctx.font = 'italic 30px Arial';
            ctx.fillStyle = '#ffffff';
            ctx.fillText("Nosso After", 256, 180);

            const texture = new THREE.CanvasTexture(canvas);
            // DoubleSide garante que dﾃｪ pra ver de qualquer lado
            const material = new THREE.MeshBasicMaterial({ map: texture, transparent: true, side: THREE.DoubleSide }); 
            const sign = new THREE.Mesh(new THREE.PlaneGeometry(12, 6), material);
            
            // Posicionar FORA da parede e virado para a rua
            sign.position.set(-11.5, 9, 0); 
            sign.rotation.y = -Math.PI / 2; // Rotaﾃｧﾃ｣o corrigida para encarar a Nicolle
            scene.add(sign);
        }

        function createEnvironment() {
            // Chﾃ｣o MAIS CLARO
            const floor = new THREE.Mesh(
                new THREE.PlaneGeometry(120, 100), 
                new THREE.MeshStandardMaterial({ color: 0x662266 }) // Roxo mais claro
            );
            floor.rotation.x = -Math.PI/2;
            scene.add(floor);

            // Parede
            const wall = new THREE.Mesh(new THREE.BoxGeometry(2, 12, 100), new THREE.MeshStandardMaterial({ color: 0x000000 }));
            wall.position.set(-10, 6, 0);
            scene.add(wall);
            // Colunas
            createColumn(-10, 6, 8);
            createColumn(-10, 6, -8);
        }

        function createColumn(x,y,z) {
            const m = new THREE.Mesh(new THREE.BoxGeometry(3,12,3), new THREE.MeshStandardMaterial({color:0x333333}));
            m.position.set(x,y,z);
            scene.add(m);
        }

        function createSprite(url, x, y, z, s) {
            const map = textureLoader.load(url);
            const mat = new THREE.SpriteMaterial({ map: map });
            const sprite = new THREE.Sprite(mat);
            sprite.position.set(x,y,z);
            sprite.scale.set(s,s,1);
            return sprite;
        }

        function initJoystick() {
            joystickManager = nipplejs.create({
                zone: document.getElementById('joystick-zone'),
                mode: 'static', position: { left: '50%', top: '50%' }, color: 'white'
            });
            joystickManager.on('move', (evt, data) => {
                moveSide = Math.cos(data.angle.radian);
                moveForward = -Math.sin(data.angle.radian);
            });
            joystickManager.on('end', () => { moveForward = 0; moveSide = 0; });
        }

        // --- SISTEMA DE ENTRADA ---
        window.escolherEntrada = function(tipo) {
            dialogBox.style.display = 'none';
            
            if (tipo === 'qrcode') {
                pixAlert.style.display = 'block';
                setTimeout(() => { pixAlert.style.display = 'none'; }, 3000);
            }
            
            entryGranted = true;
            mission = 2;
            updateUI("MISSﾃグ 2: AS BRIGAS", "Puxe o cabelo de 3 mulheres na pista! (0/3)");
            nicolle.position.x = -4; 
        };

        function updateGameLogic() {
            // Movimento
            nicolle.position.x += moveSide * 0.2;
            nicolle.position.z += moveForward * 0.2;

            // BLOQUEIO DA PORTA
            if (!entryGranted && nicolle.position.x > -8) {
                nicolle.position.x = -8.2; 
                dialogBox.style.display = 'block'; 
                moveForward = 0; moveSide = 0; 
            }

            // Missﾃｵes
            btnAction.style.display = 'none';
            nearbyTarget = null;

            npcs.forEach(npc => {
                if (nicolle.position.distanceTo(npc.position) < 4 && !npc.userData.interacted) {
                    if (mission === 2 && npc.userData.type === 'woman_fight') showBtn("BRIGAR", npc);
                    if (mission === 3 && npc.userData.type === 'man_drink') showBtn("PEGAR DRINK", npc);
                    if (mission === 4 && npc.userData.type === 'keyla') showBtn("MOLHAR KEYLA", npc);
                    if (mission === 5 && npc.userData.type === 'japa') showBtn("PEGAR JAPA", npc);
                }
            });
        }

        function showBtn(txt, tgt) {
            nearbyTarget = tgt;
            btnAction.innerText = txt;
            btnAction.style.display = 'flex';
        }

        window.executeAction = function() {
            if(!nearbyTarget) return;
            
            nicolle.position.y += 1; setTimeout(()=>nicolle.position.y-=1, 200); 

            if(mission === 2) {
                nearbyTarget.userData.interacted = true;
                nearbyTarget.material.color.setHex(0x555555);
                nearbyTarget.rotation.z = 1.5; 
                fights++;
                updateUI("MISSﾃグ 2", `Brigas: ${fights}/3`);
                if(fights>=3) { mission=3; updateUI("MISSﾃグ 3: DRINK", "Ache um homem com copo!"); }
            }
            else if(mission === 3) {
                nearbyTarget.userData.interacted = true;
                nearbyTarget.children[0].visible = false;
                mission=4; updateUI("MISSﾃグ 4: KEYLA", "Derrube na Keyla!");
            }
            else if(mission === 4) {
                nearbyTarget.userData.interacted = true;
                nearbyTarget.material.color.setHex(0xff0000);
                mission=5; updateUI("MISSﾃグ FINAL", "Pegue o Japa!");
            }
            else if(mission === 5) {
                rival.position.x += 10;
                nicolle.position.x = japa.position.x - 1; nicolle.position.z = japa.position.z;
                updateUI("FIM DE JOGO", "Vocﾃｪ zerou Nicolle Simulator!");
                btnAction.style.display = 'none';
            }
        }

        function updateUI(t, d) { uiTitle.innerText=t; uiDesc.innerText=d; }

        function animate() {
            requestAnimationFrame(animate);
            updateGameLogic();
            camera.position.x = nicolle.position.x;
            camera.position.z = nicolle.position.z + 15;
            camera.lookAt(nicolle.position);
            renderer.render(scene, camera);
        }

        init();
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth/window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth,window.innerHeight);
        });
    </script>
</body>
</html>
